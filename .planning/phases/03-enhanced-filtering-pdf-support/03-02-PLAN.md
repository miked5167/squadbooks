---
phase: 03-enhanced-filtering-pdf-support
plan: 02
type: execute
wave: 2
depends_on: ['01']
files_modified:
  - components/transactions/FilterChips.tsx
  - app/association/[associationId]/transactions/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Applied filters display as removable chips above transaction list'
    - 'Filter state persists in URL and is shareable/bookmarkable'
    - 'All filter controls integrated into association transactions page'
  artifacts:
    - path: 'components/transactions/FilterChips.tsx'
      provides: 'Removable chips for active filters with clear all button'
      min_lines: 50
    - path: 'app/association/[associationId]/transactions/page.tsx'
      provides: 'Integrated filter controls in horizontal row above table'
      exports: ['default']
  key_links:
    - from: 'components/transactions/FilterChips.tsx'
      to: 'URL searchParams removal'
      via: 'onRemove -> router.push'
      pattern: "params\\.delete"
    - from: 'app/association/[associationId]/transactions/page.tsx'
      to: '/api/transactions'
      via: 'useEffect watches searchParams -> fetch with filters'
      pattern: "searchParams\\.get.*fetch"
---

<objective>
Create FilterChips component and integrate all filter controls into association transactions page with URL state persistence.

Purpose: Complete the filtering UX by adding visual feedback for active filters and wiring all components to the transactions page.
Output: Fully functional filter interface with chips, URL state management, and integrated filter controls.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-enhanced-filtering-pdf-support/03-CONTEXT.md
@.planning/phases/03-enhanced-filtering-pdf-support/03-RESEARCH.md
@.planning/phases/03-enhanced-filtering-pdf-support/03-01-PLAN.md

# Existing code to enhance

@components/transactions/TeamFilter.tsx
@app/association/[associationId]/transactions/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Filter Chips Component</name>
  <files>components/transactions/FilterChips.tsx</files>
  <action>
Create FilterChips.tsx as a client component that:
- Accepts filters array prop: Array<{ key: string; label: string; value: string }>
- Accepts onRemove callback: (key: string) => void
- Accepts onClearAll callback: () => void
- Returns null if filters.length === 0 (don't show empty state)
- Maps over filters to render Badge components with:
  - variant="secondary"
  - Text: "{label}: {value}"
  - X button that calls onRemove(filter.key)
  - X icon from lucide-react with hover:bg-gray-300 rounded-full style
- Shows "Clear all" button if filters.length > 1 (text-sm, gray, underline, calls onClearAll)
- Uses flex-wrap layout with gap-2 for responsive chip wrapping

Follow the exact pattern from RESEARCH.md > Pattern 4: Filter Chips with Array Filtering.
Use Badge component from @/components/ui/badge.
</action>
<verify>
Component compiles without errors:

```bash
npx tsc --noEmit
```

Verify props and structure:

```bash
grep -n "interface FilterChipsProps\|onRemove\|onClearAll" components/transactions/FilterChips.tsx
```

  </verify>
  <done>
- FilterChips.tsx exists with FilterChipsProps interface
- Component accepts filters, onRemove, onClearAll props
- Returns null when no filters active
- Renders Badge for each filter with X button
- Shows "Clear all" button when multiple filters active
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate Filter Controls into Association Transactions Page</name>
  <files>app/association/[associationId]/transactions/page.tsx</files>
  <action>
Modify the association transactions page to integrate all filter components:

1. Import new components:
   - DateRangeFilter
   - MissingReceiptsToggle
   - TransactionSearch
   - FilterChips

2. Add filter controls in horizontal row ABOVE existing TeamFilter:
   - Layout: flex flex-wrap gap-4 items-end
   - Order: TeamFilter | DateRangeFilter | MissingReceiptsToggle | TransactionSearch
   - Each control wrapped in div with label if needed (maintain consistent spacing)

3. Derive active filters array from searchParams:
   - If dateFrom/dateTo exist: add chip with label "Date range", value "MMM d - MMM d, yyyy"
   - If missingReceipts === 'true': add chip with label "Filter", value "Missing receipts only"
   - If search exists: add chip with label "Search", value "{search text}"
   - TeamFilter already shows selected teams as badges - don't duplicate in chips

4. Add FilterChips component BELOW filter controls row (above table):
   - onRemove handler: parse key, delete corresponding searchParams, router.push
   - onClearAll handler: create fresh URLSearchParams, keep only teamIds if present, router.push

5. Update useEffect that fetches transactions to read new filter params:
   - Add dateFrom, dateTo, missingReceipts, search to URLSearchParams before fetch
   - These are now supported by API (Plan 01, Task 1)

6. Reset cursor to undefined when filters change (existing pattern)

Preserve all existing functionality: TeamFilter integration, drawer, cursor pagination, table display.
Follow URL state pattern: searchParams is source of truth, components update URL, useEffect reacts.
</action>
<verify>
Page compiles without errors:

```bash
npx tsc --noEmit
```

Verify imports and filter integration:

```bash
grep -n "DateRangeFilter\|MissingReceiptsToggle\|TransactionSearch\|FilterChips" app/association/[associationId]/transactions/page.tsx
```

Verify useEffect includes all filter params in fetch:

```bash
grep -A 15 "useEffect.*fetchTransactions" app/association/[associationId]/transactions/page.tsx | grep -E "dateFrom|dateTo|missingReceipts|search"
```

  </verify>
  <done>
- All filter components imported (DateRangeFilter, MissingReceiptsToggle, TransactionSearch, FilterChips)
- Filter controls row added above TeamFilter with flex layout
- FilterChips component integrated with derived active filters array
- onRemove and onClearAll handlers update URL correctly
- useEffect fetches transactions with all filter params (dateFrom, dateTo, missingReceipts, search)
- Cursor pagination reset when filters change
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. Start dev server and navigate to association transactions page
2. Verify each filter control appears in horizontal row above table
3. Test date range picker: select range, verify URL updates with dateFrom/dateTo params
4. Test missing receipts toggle: enable, verify URL updates with missingReceipts=true
5. Test search input: type vendor name, wait 300ms, verify URL updates with search param
6. Verify filter chips appear below controls showing active filters
7. Test chip removal: click X on chip, verify filter removed and URL updated
8. Test "Clear all" button: verify all filters removed except TeamFilter selection
9. Verify browser back/forward buttons restore filter state correctly
10. Copy URL with filters applied, paste in new tab, verify filters restored
    </verification>

<success_criteria>

- FilterChips component displays for all active filters (except team badges)
- Chip removal works correctly (removes individual filter)
- Clear all removes all filters except team selection
- All filter controls integrated into page layout
- URL state is shareable and bookmarkable
- Browser back/forward navigation preserves filter state
- Transaction list updates when filters change
- All filters work in combination (date + missing receipts + search)
  </success_criteria>

<output>
After completion, create `.planning/phases/03-enhanced-filtering-pdf-support/03-02-SUMMARY.md`
</output>
