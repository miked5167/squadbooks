---
phase: 03-enhanced-filtering-pdf-support
plan: 04
type: execute
wave: 4
depends_on: ['03-01', '03-02', '03-03']
files_modified: []
autonomous: false

must_haves:
  truths:
    - 'Date range filter works correctly with calendar picker and presets'
    - 'Missing receipts toggle filters transactions to show only those without receipts'
    - 'Search input debounces and filters by vendor/description'
    - 'Filter chips display for active filters and can be individually removed'
    - 'Column sorting works for Date, Amount, Category, Vendor columns'
    - 'PDF viewer displays multi-page PDFs with page navigation'
    - 'PDF zoom controls function correctly (zoom in/out)'
    - 'All filters work in combination without conflicts'
    - 'URL state is shareable (copied URL restores exact filter state)'
    - 'Browser back/forward buttons preserve filter and sort state'
  artifacts: []
  key_links: []
---

<objective>
Human verification of all Phase 3 filtering and PDF viewing features to ensure correct behavior and user experience.

Purpose: Validate that advanced filtering, sorting, and PDF viewing work correctly individually and in combination before marking phase complete.
Output: Confirmed working features or documented issues for revision.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-enhanced-filtering-pdf-support/03-CONTEXT.md
@.planning/phases/03-enhanced-filtering-pdf-support/03-01-PLAN.md
@.planning/phases/03-enhanced-filtering-pdf-support/03-02-PLAN.md
@.planning/phases/03-enhanced-filtering-pdf-support/03-03-PLAN.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Claude automated:
- API route enhancement for dateFrom, dateTo, missingReceipts filter parameters
- Date range filter component with calendar picker and presets (Last 7/30 days, This month)
- Missing receipts toggle component
- Debounced search input (300ms delay) for vendor/description filtering
- Filter chips component with individual removal and "Clear all" functionality
- Column sorting for Date, Amount, Category, Vendor columns
- Enhanced PDF viewer with react-pdf (page navigation, zoom controls)
- Integration of all filters into association transactions page with URL state persistence
  </what-built>

  <how-to-verify>
**Prerequisites:**
1. Start dev server: `npm run dev`
2. Navigate to: `http://localhost:3000/association/[associationId]/transactions`
   (Use your actual association ID from database)
3. Ensure you're logged in as an association user (not team treasurer)

**Test Sequence:**

**A. Date Range Filter (FILTER-02)**

1. Click "Select date range" button
2. Verify calendar popover opens with 2 months side-by-side
3. Click "Last 7 days" preset
4. Verify:
   - Date range displays in button (e.g., "Jan 12 - Jan 19, 2026")
   - URL updates with dateFrom and dateTo parameters
   - Transaction list updates to show only transactions in date range
5. Click date range button again, select different dates from calendar
6. Verify transaction list updates
7. Click "Clear" in date picker
8. Verify date filter removed and all transactions show

**B. Missing Receipts Toggle (FILTER-03)**

1. Click "Missing receipts only" toggle ON
2. Verify:
   - URL updates with missingReceipts=true parameter
   - Transaction list shows only transactions with "No Receipt" badge
   - Filter chip appears: "Filter: Missing receipts only"
3. Toggle OFF
4. Verify transactions with receipts return to list

**C. Search Input (FILTER-04)**

1. Type a vendor name (e.g., "Walmart") in search box
2. Wait 300ms (debounce delay)
3. Verify:
   - URL updates with search parameter
   - Transaction list filters to matching vendor/description
   - Filter chip appears: "Search: Walmart"
4. Clear search input
5. Verify all transactions return

**D. Filter Chips (FILTER-07)**

1. Apply multiple filters:
   - Select date range
   - Toggle missing receipts ON
   - Enter search term
2. Verify filter chips row shows all 3 chips
3. Click X on search chip
4. Verify search filter removed, date and missing receipts remain
5. Click "Clear all" button
6. Verify all filters removed except team selection

**E. Column Sorting (FILTER-05)**

1. Click "Date" column header
2. Verify:
   - Sort indicator appears (↓ for descending)
   - URL updates with sortBy=date&sortDir=desc
   - Transactions sort by date (newest first)
3. Click "Date" again
4. Verify indicator flips to ↑ and transactions reverse order (oldest first)
5. Click "Amount" column header
6. Verify sort switches to amount (highest first with ↓)
7. Click "Category" column header
8. Verify transactions sort alphabetically by category name
9. Click "Vendor" column header
10. Verify transactions sort alphabetically by vendor

**F. PDF Viewer (RECEIPT-03, RECEIPT-04, RECEIPT-05)**

1. Click on a transaction with a PDF receipt
2. Verify ReceiptViewer dialog opens
3. Verify PDF renders (page 1 visible)
4. If multi-page PDF available:
   - Verify page indicator shows "Page 1 of X"
   - Click next page button
   - Verify page 2 displays
   - Click previous button
   - Verify page 1 displays
5. Test zoom controls:
   - Click zoom in button multiple times
   - Verify PDF scales up, percentage updates (e.g., "125%", "150%")
   - Verify zoom in disabled at 300%
   - Click zoom out button
   - Verify PDF scales down
   - Verify zoom out disabled at 50%
6. Click Download button
7. Verify PDF downloads correctly
8. Close dialog

**G. Combined Filters (FILTER-08)**

1. Apply all filters simultaneously:
   - Select date range: Last 30 days
   - Toggle missing receipts ON
   - Enter search: specific vendor
   - Sort by: Amount descending
2. Verify:
   - All filters apply (transaction list filtered and sorted correctly)
   - URL contains all parameters: dateFrom, dateTo, missingReceipts, search, sortBy, sortDir
   - Filter chips show date range, missing receipts, search
   - Sort indicator shows on Amount column
3. Verify transaction count makes sense (fewer results with more filters)

**H. URL Shareability (FILTER-06)**

1. With all filters applied, copy current URL from browser address bar
2. Open new browser tab
3. Paste URL and navigate
4. Verify:
   - All filters restored exactly (date range, missing receipts, search, sort)
   - Filter chips display correctly
   - Transaction list matches original tab

**I. Browser Navigation**

1. Apply date range filter
2. Click browser back button
3. Verify filter removed (URL updates, transactions update)
4. Click browser forward button
5. Verify filter restored
6. Apply multiple filter changes (date -> search -> sort)
7. Click back button multiple times
8. Verify each previous state restores correctly

**J. Filter Result Counts (FILTER-08)**

1. With no filters applied, note transaction count at bottom
2. Apply date range filter
3. Verify count decreases and updates
4. Add missing receipts filter
5. Verify count decreases further
6. Verify count shows: "Showing X transaction(s)"

**K. Edge Cases**

1. Test with no transactions matching filters
2. Verify empty state message displays
3. Test with single transaction result
4. Verify pagination doesn't show "Load More" button
5. Test with 50+ transactions matching filters
6. Verify pagination works (Load More button appears and functions)
7. Click transaction with image receipt (JPG/PNG)
8. Verify image viewer still works (not broken by PDF enhancement)

**Expected Behavior Summary:**

- All filters update URL immediately (or after debounce for search)
- Transaction list updates reactively when filters change
- Filter chips reflect active filters accurately
- Browser back/forward preserves complete filter state
- Copied URLs restore exact filter state in new tabs
- PDF viewer handles single and multi-page PDFs
- Image receipts still work with existing viewer
- All filters work in combination without conflicts
</how-to-verify>

  <resume-signal>
Type "approved" if all features work correctly.

If issues found, describe:

- Which test failed
- Expected behavior
- Actual behavior
- Browser console errors (if any)

Format:

```
Issue 1: [Description]
Test: [Which test section]
Expected: [What should happen]
Actual: [What happened]
Console: [Any errors]
```

Claude will fix reported issues and re-verify.
</resume-signal>
</task>

</tasks>

<verification>
This plan IS the verification. Human testing confirms all features work correctly.
</verification>

<success_criteria>
Human confirms:

- Date range filter functional with calendar and presets
- Missing receipts toggle functional
- Search input debounced and filters correctly
- Filter chips display and removal works
- Column sorting works for all sortable columns
- PDF viewer displays with page navigation and zoom
- All filters work in combination
- URL state is shareable and restorable
- Browser navigation preserves filter state
- No console errors during normal operation
  </success_criteria>

<output>
After human approval, create `.planning/phases/03-enhanced-filtering-pdf-support/03-04-SUMMARY.md`
</output>
