---
phase: 02-association-dashboard-view
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/association/[associationId]/transactions/page.tsx
autonomous: true

must_haves:
  truths:
    - 'Association user can view transactions from all accessible teams on dedicated transactions page'
    - 'Transaction list displays date, vendor, amount, category, team name, and receipt status'
    - 'Transaction list uses cursor-based pagination with 50 items per page'
    - 'Association user can filter transactions by team using multi-select dropdown'
    - 'Association user can click transaction row to view receipt in drawer'
  artifacts:
    - path: 'app/association/[associationId]/transactions/page.tsx'
      provides: 'Association transactions page with filtering and drawer integration'
      min_lines: 300
      exports: ['default']
  key_links:
    - from: 'app/association/[associationId]/transactions/page.tsx'
      to: '/api/transactions'
      via: 'fetch with teamIds parameter'
      pattern: 'fetch.*api/transactions.*teamIds'
    - from: 'app/association/[associationId]/transactions/page.tsx'
      to: 'components/transactions/TeamFilter'
      via: 'import and render TeamFilter component'
      pattern: 'import.*TeamFilter.*from'
    - from: 'app/association/[associationId]/transactions/page.tsx'
      to: 'components/transactions/transaction-details-drawer'
      via: 'TransactionDetailsDrawer with isReadOnly prop'
      pattern: 'isReadOnly.*true'
---

<objective>
Create dedicated association transactions page that allows association users to view all team transactions with team filtering and receipt viewing.

Purpose: Deliver core association oversight capability - viewing transactions across multiple teams from a centralized page with basic team filtering.

Output: Working association transactions page at `/app/association/[associationId]/transactions` with cursor pagination, team filtering, and read-only drawer integration.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-association-dashboard-view/02-RESEARCH.md
@.planning/phases/02-association-dashboard-view/02-CONTEXT.md

# Existing patterns to clone and adapt

@app/transactions/page.tsx
@components/transactions/TeamFilter.tsx
@components/transactions/transaction-details-drawer.tsx
@app/association/[associationId]/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Create Association Transactions Page</name>
  <files>app/association/[associationId]/transactions/page.tsx</files>
  <action>
Create new page component for association transaction viewing by cloning and adapting the existing `/app/transactions/page.tsx` pattern.

**Key adaptations from source pattern:**

1. **Async params handling** (Next.js 14+ requirement):
   - Use `params: Promise<{ associationId: string }>` type
   - Resolve params in useEffect with useState pattern
   - See `app/association/[associationId]/teams/page.tsx` for reference

2. **Add team name column** to transaction table:
   - Table should have columns: Date, Team, Vendor, Category, Amount, Receipt
   - Team column is NEW (not in original `/app/transactions/page.tsx`)
   - Display team name from `transaction.team.name` relation
   - Position team column between date and vendor

3. **Integrate TeamFilter component**:
   - Import and render `TeamFilter` component in filters section
   - TeamFilter handles URL param updates automatically
   - No custom logic needed - component is self-contained

4. **Implement URL-driven transaction fetching** (CRITICAL WIRING):
   - Add useEffect that reads `teamIds` from URL searchParams
   - When teamIds change (via TeamFilter updates), fetch transactions from `/api/transactions` endpoint
   - Pass teamIds as query parameter: `/api/transactions?teamIds=${ids.join(',')}&limit=50`
   - Handle comma-separated teamIds list (e.g., "team1,team2,team3")
   - Reset pagination cursor when teamIds change

5. **Use TransactionDetailsDrawer with read-only mode**:
   - Import `TransactionDetailsDrawer` from `@/components/transactions/transaction-details-drawer`
   - Pass `isReadOnly={true}` prop (association users have read-only access)
   - Wire up onClick handler to open drawer when row clicked

6. **Cursor pagination** (required by VIEW-05):
   - Use same pagination pattern from source (nextCursor, loadMore)
   - Limit: 50 items per page (per Phase 2 success criteria)
   - Reset cursor when filters change

7. **Page layout**:
   - Use association layout wrapper (automatically applied by `app/association/[associationId]/layout.tsx`)
   - Header section with title "Transactions" and count display
   - Filters card with TeamFilter component
   - Transaction list card with table
   - Drawer component at bottom

8. **Error handling**:
   - Handle empty teams list (show message if no teams accessible)
   - Handle empty transaction list (show "No transactions found" state)
   - Toast notifications for fetch errors via sonner

**Why certain choices:**

- `isReadOnly={true}`: Enforces VIEW-03 requirement (association users have read-only access)
- Team column: Required by VIEW-04 (display team name in transaction list)
- Clone existing pattern: Ensures consistency with team user experience, reduces implementation risk
- TeamFilter: Already handles multi-select, URL sync, "All Teams" default per RESEARCH.md Pattern 4
- URL-driven fetch: TeamFilter updates URL, useEffect reacts to URL changes, fetches data - this is the critical link that makes filtering work
  </action>
  <verify>

1. File exists at `app/association/[associationId]/transactions/page.tsx`
2. File contains TransactionDetailsDrawer with `isReadOnly={true}`
3. File imports and renders TeamFilter component
4. Table has Team column between Date and Vendor
5. Cursor pagination logic present (nextCursor, loadMore function)
6. Async params handling pattern used (useEffect with await params)
7. useEffect hook reads teamIds from URL searchParams
8. Fetch call passes teamIds to /api/transactions endpoint

Verification commands:

```bash
# Check file exists
ls "app/association/[associationId]/transactions/page.tsx"

# Verify key patterns (PATTERN VERIFICATION ONLY - functional verification in 02-03)
grep -n "isReadOnly.*true" "app/association/[associationId]/transactions/page.tsx"
grep -n "TeamFilter" "app/association/[associationId]/transactions/page.tsx"
grep -n "Team.*TableHead" "app/association/[associationId]/transactions/page.tsx"
grep -n "nextCursor" "app/association/[associationId]/transactions/page.tsx"
grep -n "await params" "app/association/[associationId]/transactions/page.tsx"
grep -n "searchParams.*teamIds" "app/association/[associationId]/transactions/page.tsx"
grep -n "api/transactions.*teamIds" "app/association/[associationId]/transactions/page.tsx"
```

**Note:** These grep checks verify code patterns exist but do NOT confirm functional correctness. Full functional verification (filtering actually works, pagination doesn't break, drawer opens correctly) occurs in Plan 02-03 human verification checkpoint.

  </verify>
  <done>
- Association transactions page exists at correct path
- Page displays transaction table with date, team, vendor, category, amount, receipt columns
- TeamFilter component integrated and functional
- useEffect hook implemented that reads teamIds from URL searchParams
- Fetch logic passes teamIds parameter to /api/transactions endpoint
- Cursor pagination implemented with 50 item limit
- TransactionDetailsDrawer opens with read-only mode when transaction clicked
- Async params properly handled per Next.js 14+ requirements
- Empty states handled (no teams, no transactions)
  </done>
</task>

</tasks>

<verification>
**Overall phase checks:**

1. Navigate to `/association/[associationId]/transactions` in browser
2. Verify transaction list loads and displays all columns including team name
3. Verify TeamFilter shows accessible teams and updates view when selection changes
4. Verify cursor pagination loads more transactions when "Load More" clicked
5. Verify clicking transaction row opens drawer with receipt or "No receipt" state
6. Verify drawer has no edit/upload buttons (read-only mode)
7. Verify page handles empty states gracefully

**Requirements coverage:**

- VIEW-01: Association user can view all transactions from all teams ✓
- VIEW-04: Transaction list displays date, vendor, amount, category, team name, receipt status ✓
- VIEW-05: Cursor-based pagination with 50 items per page ✓
- NAV-02: Dedicated transactions page for cross-team analysis ✓
- RECEIPT-01: Click transaction to view receipt in drawer ✓
- RECEIPT-06: Drawer shows "No receipt" state ✓
  </verification>

<success_criteria>

1. Association transactions page accessible at `/association/{id}/transactions`
2. Transaction table displays with team name column visible
3. TeamFilter component allows filtering by team(s)
4. Cursor pagination loads 50 transactions per page
5. Clicking transaction opens drawer with receipt or no-receipt state
6. Drawer is read-only (no edit buttons, no upload buttons)
7. Page handles edge cases (no teams, no transactions) without crashing
   </success_criteria>

<output>
After completion, create `.planning/phases/02-association-dashboard-view/02-01-SUMMARY.md` documenting:
- Files created
- Pattern adaptations from source (`/app/transactions/page.tsx`)
- Team column addition details
- Any deviations or issues encountered
</output>
