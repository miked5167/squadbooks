---
phase: 02-association-dashboard-view
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - app/association/[associationId]/teams/[teamId]/page.tsx
  - app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx
autonomous: true

must_haves:
  truths:
    - 'Association user can view team transactions from team details page'
    - 'Transaction list on team details page is pre-filtered to selected team only'
    - 'Team details transaction view uses same UI components as dedicated transactions page'
    - 'Transaction drawer opens with read-only mode from team details page'
  artifacts:
    - path: 'app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx'
      provides: 'Reusable transaction section component for team details'
      min_lines: 100
      exports: ['TransactionsSection']
    - path: 'app/association/[associationId]/teams/[teamId]/page.tsx'
      provides: 'Team details page with embedded transaction section'
      min_lines: 50
      contains: 'TransactionsSection'
  key_links:
    - from: 'app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx'
      to: '/api/transactions'
      via: 'fetch with pre-filtered teamId'
      pattern: 'teamIds.*teamId'
    - from: 'app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx'
      to: 'components/transactions/transaction-details-drawer'
      via: 'TransactionDetailsDrawer with isReadOnly prop'
      pattern: 'isReadOnly.*true'
---

<objective>
Enable association users to view team transactions from team details page with pre-filtering to selected team.

Purpose: Support contextual investigation use case - association users drilling down from team overview to specific team transactions without leaving team context.

Output: Team details page enhanced with transaction viewing section that shows transactions pre-filtered to the selected team, using consistent UI components and read-only enforcement.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/02-association-dashboard-view/02-RESEARCH.md
@.planning/phases/02-association-dashboard-view/02-CONTEXT.md

# Reference patterns

@app/association/[associationId]/transactions/page.tsx
@components/transactions/transaction-details-drawer.tsx

# Files to modify

@app/association/[associationId]/teams/[teamId]/page.tsx
@app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx
</context>

<tasks>

<task type="auto">
  <name>Create TransactionsSection Component</name>
  <files>app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx</files>
  <action>
Check if `TransactionsSection.tsx` already exists in `app/association/[associationId]/teams/[teamId]/`. If it exists, enhance it for association user context. If it doesn't exist, create it.

**Component purpose:** Reusable transaction viewing section for team details page that pre-filters to a specific team.

**Implementation:**

1. **Create/update TransactionsSection component**:
   - Accept props: `teamId: string`, `isAssociationUser?: boolean`
   - Fetch transactions using `/api/transactions?teamIds={teamId}&limit=50`
   - Display transaction table with columns: Date, Vendor, Category, Amount, Receipt
   - NO team column (already in team context - user knows which team)
   - Implement cursor pagination for load more functionality

2. **Transaction table structure**:
   - Same table structure as association transactions page
   - Remove team column (redundant in team context)
   - Keep: Date, Vendor, Category, Amount, Receipt Status
   - Clickable rows to open transaction details drawer

3. **Integrate TransactionDetailsDrawer**:
   - Import and render `TransactionDetailsDrawer`
   - Pass `isReadOnly={isAssociationUser ?? false}` prop
   - Open drawer on transaction row click
   - Handle selected transaction state

4. **Loading and empty states**:
   - Show skeleton loader while fetching
   - Show "No transactions found" if team has no transactions
   - Show "View All Transactions" link to association transactions page

5. **Pagination**:
   - Cursor-based pagination matching association transactions page
   - "Load More" button at bottom if nextCursor exists
   - Limit: 50 items per page

6. **Error handling**:
   - Toast notification on fetch errors
   - Graceful degradation if API fails

**Key differences from association transactions page:**

- Pre-filtered to single team (no TeamFilter component)
- No team column in table (already in team context)
- Link to "View All Transactions" for cross-team analysis

**Why certain choices:**

- `isReadOnly={isAssociationUser}`: Supports both association users (read-only) and team users (can edit)
- Remove team column: In team details context, team is already known - column adds no value
- Cursor pagination: Consistent with association page, performant for large transaction lists
  </action>
  <verify>

1. File exists at correct path
2. Component accepts teamId and isAssociationUser props
3. Fetches transactions with pre-filtered teamId parameter
4. Table has Date, Vendor, Category, Amount, Receipt columns (NO team column)
5. TransactionDetailsDrawer integrated with isReadOnly prop
6. Cursor pagination implemented

Verification commands:

```bash
# Check file exists
ls "app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx"

# Verify key patterns
grep -n "teamId.*string" "app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx"
grep -n "isAssociationUser" "app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx"
grep -n "teamIds.*teamId" "app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx"
grep -n "TransactionDetailsDrawer" "app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx"
grep -n "nextCursor" "app/association/[associationId]/teams/[teamId]/TransactionsSection.tsx"
```

  </verify>
  <done>
- TransactionsSection component created/updated
- Component accepts teamId and isAssociationUser props
- Transactions pre-filtered to specific team via API query
- Table displays without team column (Date, Vendor, Category, Amount, Receipt)
- TransactionDetailsDrawer opens with appropriate read-only mode
- Cursor pagination implemented with 50 item limit
- Empty states and error handling in place
  </done>
</task>

<task type="auto">
  <name>Integrate TransactionsSection into Team Details Page</name>
  <files>app/association/[associationId]/teams/[teamId]/page.tsx</files>
  <action>
Enhance the team details page to display the TransactionsSection component.

**Implementation:**

1. **Import TransactionsSection**:
   - Add import: `import { TransactionsSection } from './TransactionsSection'`

2. **Detect association user context**:
   - Check if current user is association user
   - Methods to detect:
     - Check user's role via permissions hook
     - Check if user has `associationId` but no direct team membership
     - Use existing permission system patterns from codebase

3. **Add TransactionsSection to page layout**:
   - Find appropriate section in team details page (likely after team info)
   - Add section with header: "Recent Transactions" or "Team Transactions"
   - Render: `<TransactionsSection teamId={teamId} isAssociationUser={isAssocUser} />`
   - Add link to full transactions view: "View All Transactions" -> `/association/{id}/transactions?teamIds={teamId}`

4. **Tabs or sections** (if team details uses tabs):
   - If page uses tabs, add "Transactions" tab
   - If page uses sections, add as new section
   - Follow existing page layout pattern

5. **Async params handling**:
   - Ensure teamId is properly resolved from async params
   - Pass resolved teamId to TransactionsSection component

**Why certain choices:**

- Contextual placement: Transaction section should be easily discoverable but not overwhelming
- Link to full view: Allows drilling deeper for extensive transaction investigation
- isAssociationUser detection: Ensures proper read-only enforcement based on user role
  </action>
  <verify>

1. Team details page imports TransactionsSection component
2. TransactionsSection rendered with teamId prop
3. Association user detection logic present
4. Link to full transactions view with pre-filtered teamId

Verification commands:

```bash
# Verify integration
grep -n "TransactionsSection" "app/association/[associationId]/teams/[teamId]/page.tsx"
grep -n "from './TransactionsSection'" "app/association/[associationId]/teams/[teamId]/page.tsx"
grep -n "teamId.*TransactionsSection" "app/association/[associationId]/teams/[teamId]/page.tsx"
```

  </verify>
  <done>
- Team details page imports and renders TransactionsSection
- TransactionsSection receives teamId and isAssociationUser props
- Association user context properly detected
- Section placed logically within team details layout
- Link to full transactions view available for deeper investigation
  </done>
</task>

</tasks>

<verification>
**Overall phase checks:**

1. Navigate to team details page: `/association/[associationId]/teams/[teamId]`
2. Verify transactions section is visible on the page
3. Verify transaction list shows only transactions for selected team
4. Verify table does NOT have team column (redundant in team context)
5. Verify clicking transaction opens drawer with receipt or "No receipt" state
6. Verify drawer is read-only for association users
7. Verify "View All Transactions" link navigates to association transactions page with team pre-selected

**Requirements coverage:**

- NAV-01: Association user can view team transactions from team details page ✓
- NAV-03: Both views use consistent UI components ✓
- NAV-04: Team details view pre-filters to selected team ✓
- VIEW-04: Transaction list displays key information ✓
- RECEIPT-01: Click transaction to view receipt ✓
  </verification>

<success_criteria>

1. Team details page displays TransactionsSection component
2. Transactions pre-filtered to selected team only
3. Table does not include team column (contextually redundant)
4. Clicking transaction opens drawer with appropriate read-only mode
5. Cursor pagination works for teams with many transactions
6. Link to full transactions view navigates correctly with team filter applied
7. Consistent UI components used across both transaction views
   </success_criteria>

<output>
After completion, create `.planning/phases/02-association-dashboard-view/02-02-SUMMARY.md` documenting:
- Files created/modified
- Component structure for TransactionsSection
- Integration approach with team details page
- Any deviations or issues encountered
</output>
