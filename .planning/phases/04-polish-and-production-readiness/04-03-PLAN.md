---
phase: 04-polish-and-production-readiness
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - prisma/seed-production-scale.ts
  - tests/performance/dashboard-load.spec.ts
  - package.json
autonomous: true

must_haves:
  truths:
    - 'Seed script generates 50 teams with ~400 transactions each (20K total)'
    - 'Transaction dates span realistic range (past 12 months)'
    - '70% of transactions have receipts (realistic distribution)'
    - 'Performance test measures LCP < 2000ms for dashboard load'
    - 'Performance test runs against production build (npm run build)'
  artifacts:
    - path: 'prisma/seed-production-scale.ts'
      provides: 'Production-scale seed data generator'
      min_lines: 80
    - path: 'tests/performance/dashboard-load.spec.ts'
      provides: 'Playwright performance test for Core Web Vitals'
      min_lines: 50
  key_links:
    - from: 'package.json'
      to: 'prisma/seed-production-scale.ts'
      via: 'npm script for seeding production data'
      pattern: 'seed:prod.*tsx.*seed-production-scale'
---

<objective>
Validate production performance by seeding realistic data volumes (50 teams, 20K transactions) and measuring Core Web Vitals.

Purpose: Address STATE.md blocker ("Performance baseline tested with 5 teams vs. target 50 teams") and verify <2s dashboard load per success criteria.

Output: Production-scale seed script, Playwright performance test, validation that dashboard meets performance targets.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish-and-production-readiness/04-CONTEXT.md
@.planning/phases/04-polish-and-production-readiness/04-RESEARCH.md
@prisma/seed-demo.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Production-Scale Seed Script</name>
  <files>prisma/seed-production-scale.ts</files>
  <action>
Create production-scale seed script based on RESEARCH.md Pattern 7 (Production-Scale Seed Data).

Reference existing seed-demo.ts for schema patterns and data structure.

Target:

- 50 teams in single test association
- 400 transactions per team (20,000 total)
- Date range: Past 12 months (random dates within range)
- Receipt distribution: 70% have receipts, 30% missing (realistic for oversight testing)
- Categories: Mix across existing budget categories
- Amounts: Random between $10 and $2000 (realistic team spending)

Implementation:

1. Import PrismaClient, existing category/team creation utilities from seed-demo.ts
2. Create or reuse test association
3. Loop: create 50 teams
4. For each team: batch insert 400 transactions using prisma.transaction.createMany
5. Progress logging: every 10 teams, log "Seeded X teams..."
6. Final log: "Production-scale seed complete! 50 teams, 20K transactions"

Use batch insert (createMany) for performance - don't create transactions one by one.

Handle cleanup: Delete existing production seed data before creating new (or use upsert pattern).
</action>
<verify>
File exists at prisma/seed-production-scale.ts
Script imports PrismaClient
Script uses createMany for batch inserts
TypeScript compilation passes (tsx can execute the file)
Script logs progress every 10 teams
</verify>
<done>
Production-scale seed script created, ready to generate 50 teams with 20K transactions.
</done>
</task>

<task type="auto">
  <name>Task 2: Create Playwright Performance Test</name>
  <files>tests/performance/dashboard-load.spec.ts</files>
  <action>
Create Playwright performance test based on RESEARCH.md Pattern 7 (Performance Testing with Realistic Data).

Test: Association dashboard loads in <2 seconds with 20K transactions.

Implementation:

1. Import test, expect from @playwright/test
2. Test: "dashboard loads in <2s with 20K transactions"
3. Navigate to /association/[test-association-id]/transactions
4. Measure Core Web Vitals using page.evaluate():
   - Largest Contentful Paint (LCP)
   - First Contentful Paint (FCP)
   - Cumulative Layout Shift (CLS)
5. Assertions:
   - expect(metrics.LCP).toBeLessThan(2000) // 2 seconds per success criteria
   - expect(metrics.CLS).toBeLessThan(0.1) // Good CLS score
6. Console log metrics for visibility

Use RESEARCH.md code example for web vitals measurement (PerformanceObserver pattern).

Note: Test requires production build running (npm run build && npm start), document in test comments.
</action>
<verify>
File exists at tests/performance/dashboard-load.spec.ts
Test imports from @playwright/test
Test navigates to association transactions page
Test measures LCP and asserts <2000ms
Test includes comment about running against production build
TypeScript compilation passes
</verify>
<done>
Performance test created to validate <2s dashboard load with production-scale data.
</done>
</task>

<task type="auto">
  <name>Task 3: Add npm Script and Document Performance Testing</name>
  <files>package.json</files>
  <action>
Add npm script for running production-scale seed:

```json
"scripts": {
  "seed:prod": "tsx prisma/seed-production-scale.ts"
}
```

Add to existing scripts section (after seed:demo if it exists).

No need to modify existing "seed" script - keep separate for different use cases.

Document performance testing workflow in task notes:

1. Run production seed: npm run seed:prod
2. Build production: npm run build
3. Start production server: npm start
4. Run performance test: npx playwright test tests/performance/dashboard-load.spec.ts
   </action>
   <verify>
   package.json contains "seed:prod" script
   Script references tsx and seed-production-scale.ts
   TypeScript compilation passes
   npm run seed:prod command is valid (can be executed)
   </verify>
   <done>
   npm script created for production seed, performance testing workflow documented.
   </done>
   </task>

</tasks>

<verification>
Run production seed and performance test:

```bash
# 1. Seed production-scale data
npm run seed:prod

# 2. Build production bundle
npm run build

# 3. Start production server (in separate terminal)
npm start

# 4. Run performance test
npx playwright test tests/performance/dashboard-load.spec.ts
```

Manual verification:

- Seed script completes without errors
- Database contains 50 teams with ~20K transactions
- Performance test passes (<2s LCP assertion)
- Dashboard loads smoothly with production data
- No memory issues or crashes during load
  </verification>

<success_criteria>

- [ ] Production-scale seed script creates 50 teams with 20K transactions
- [ ] Seed uses batch inserts (createMany) for performance
- [ ] Playwright performance test measures LCP < 2000ms
- [ ] Performance test includes CLS measurement
- [ ] npm script "seed:prod" added to package.json
- [ ] Performance test passes with production build
- [ ] No TypeScript compilation errors
      </success_criteria>

<output>
After completion, create `.planning/phases/04-polish-and-production-readiness/04-03-SUMMARY.md`
</output>
