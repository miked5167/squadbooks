---
phase: 04-polish-and-production-readiness
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - app/association/[associationId]/transactions/page.tsx
  - components/transactions/ErrorState.tsx
  - lib/constants/error-messages.ts
autonomous: true

must_haves:
  truths:
    - 'API fetch errors display inline replacement messages (not toast notifications)'
    - 'Error messages are user-friendly with no technical details'
    - "Users can retry failed requests via 'Try Again' button"
    - 'Pagination loading shows both disabled button AND spinner for clarity'
  artifacts:
    - path: 'components/transactions/ErrorState.tsx'
      provides: 'Reusable error state component with retry'
      min_lines: 30
    - path: 'lib/constants/error-messages.ts'
      provides: 'Centralized error message constants'
      exports: ['ERROR_MESSAGES']
    - path: 'app/association/[associationId]/transactions/page.tsx'
      provides: 'Inline error replacement for fetch failures'
      contains: 'ErrorState'
  key_links:
    - from: 'app/association/[associationId]/transactions/page.tsx'
      to: 'components/transactions/ErrorState.tsx'
      via: 'import and render in catch blocks'
      pattern: 'import.*ErrorState.*from.*components'
    - from: 'components/transactions/ErrorState.tsx'
      to: 'lib/constants/error-messages.ts'
      via: 'import error message constants'
      pattern: 'ERROR_MESSAGES'
---

<objective>
Replace toast-based error notifications with inline error states and improve pagination loading clarity for better user experience.

Purpose: Ensure errors are contextual (replacing failed content), messages are user-friendly, and loading states provide maximum clarity (per CONTEXT.md decisions).

Output: Inline error replacement pattern with retry capability, improved pagination loading UX.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-polish-and-production-readiness/04-CONTEXT.md
@.planning/phases/04-polish-and-production-readiness/04-RESEARCH.md
@app/association/[associationId]/transactions/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Centralized Error Messages Constants</name>
  <files>lib/constants/error-messages.ts</files>
  <action>
Create error message constants file with user-friendly messages (no technical details).

Include messages for:

- FETCH_FAILED: "Unable to load transactions. Please try again."
- TIMEOUT: "Request timed out. Please try again."
- PERMISSION_DENIED: "You don't have permission to view this data."
- NETWORK_ERROR: "Network error. Please check your connection and try again."
- NOT_FOUND: "The requested data could not be found."

Export as const object for type safety.

Reference: RESEARCH.md Pattern 3 (Inline Error States)
</action>
<verify>
File exists at lib/constants/error-messages.ts
TypeScript compilation passes (npm run build succeeds)
ERROR_MESSAGES export is typed as const
</verify>
<done>
Error message constants created and ready for import by components.
</done>
</task>

<task type="auto">
  <name>Task 2: Create Reusable ErrorState Component</name>
  <files>components/transactions/ErrorState.tsx</files>
  <action>
Create ErrorState component matching RESEARCH.md Pattern 3:

Props:

- message: string (user-friendly error message)
- onRetry: () => void (callback to retry failed operation)

UI:

- Centered flex column layout with py-12 padding
- AlertCircle icon from lucide-react (h-12 w-12, text-destructive)
- Message in text-sm text-foreground
- "Try Again" button (variant="outline", onClick calls onRetry)

Import from lib/constants/error-messages.ts for type safety.

Do NOT use toast or banner - this component replaces content area.
</action>
<verify>
File exists at components/transactions/ErrorState.tsx
Component renders without TypeScript errors
Component accepts message and onRetry props
Component imports AlertCircle and Button from shadcn/ui
</verify>
<done>
ErrorState component created and ready for integration in transactions page.
</done>
</task>

<task type="auto">
  <name>Task 3: Replace Toast Errors with Inline ErrorState</name>
  <files>app/association/[associationId]/transactions/page.tsx</files>
  <action>
Update association transactions page to use inline error replacement (per CONTEXT.md: "Inline replacement - not toast or banner"):

1. Add error state variable: `const [error, setError] = useState<string | null>(null)`

2. In fetchInitialTransactions catch block:
   - Remove toast.error() call
   - Set error state with user-friendly message from ERROR_MESSAGES
   - Example: setError(ERROR_MESSAGES.FETCH_FAILED)

3. In loadMoreTransactions catch block:
   - Keep toast for pagination errors (background operation, not primary content)
   - OR use inline spinner replacement below existing content (Claude's discretion)

4. Render ErrorState component when error exists:
   - Replace transaction list content area with <ErrorState message={error} onRetry={handleRetry} />
   - handleRetry callback clears error and calls fetchInitialTransactions()

5. Improve pagination loading clarity (per CONTEXT.md: "maximum clarity"):
   - Load More button: disabled={loadingMore} AND shows "Loading..." text
   - Below button: {loadingMore && <Loader2 className="h-6 w-6 animate-spin text-muted-foreground" />}
   - Wrap in flex flex-col items-center gap-4 py-6

Import ERROR_MESSAGES from lib/constants/error-messages.ts.
Import ErrorState from components/transactions/ErrorState.tsx.

Keep loading state for initial load (existing skeleton is fine).
</action>
<verify>
TypeScript compilation passes (npm run build)
Error state variable declared and used in catch blocks
ErrorState component imported and rendered when error exists
Pagination loading shows both disabled button AND spinner
No toast.error() calls remain for primary content fetch failures
</verify>
<done>
Association transactions page uses inline error replacement with retry, pagination loading provides maximum clarity.
</done>
</task>

</tasks>

<verification>
Run TypeScript compilation to verify no errors:
```bash
npm run build
```

Manual check:

- Open association transactions page
- Simulate fetch error (network offline or invalid URL)
- Verify error message displays inline (replaces transaction list)
- Verify "Try Again" button appears and is clickable
- Verify error message is user-friendly (no stack traces or error codes)
- Test pagination loading: verify button disables AND spinner appears
  </verification>

<success_criteria>

- [ ] ERROR_MESSAGES constant created with 5+ user-friendly messages
- [ ] ErrorState component created with AlertCircle icon and retry button
- [ ] Association transactions page replaces toast errors with inline ErrorState
- [ ] Pagination loading shows disabled button + spinner simultaneously
- [ ] No TypeScript compilation errors
- [ ] Error messages contain no technical details (no URLs, error codes, stack traces)
      </success_criteria>

<output>
After completion, create `.planning/phases/04-polish-and-production-readiness/04-01-SUMMARY.md`
</output>
